# Epic 10 Retrospective: Advanced Image Tools

**Date:** 2026-02-15
**Facilitator:** Bob (Scrum Master)
**Epic Status:** Partial — 1/2 stories done, 1 in review

## Team Participants

- Bob (Scrum Master) — Facilitator
- Alice (Product Owner) — Product perspective
- Charlie (Senior Dev) — Technical leadership
- Dana (QA Engineer) — Quality perspective
- Elena (Junior Dev) — Fresh eyes perspective
- csrteam (Project Lead) — Overall direction

## Epic Summary & Metrics

**Delivery:**

- Stories completed: 1/2 (50% — partial retro)
- Story 10-1 (Image Compression): done
- Story 10-2 (Image Cropping): review (implementation complete, code review pending)
- All tasks checked off in both stories
- Production incidents: 0

**Quality:**

- Tests: 562 total (24 new in 10-2, 0 regressions)
- Code review findings (10-1): 7 total (2H, 3M, 2L) — 5 fixed, 2 deferred
- Code review findings (10-2): Pending
- Debug issues: 4 total (2 per story — all minor: import paths, formatting)
- Technical debt introduced: 2 LOW items deferred from 10-1
- New dependencies: 1 (`react-image-crop@11.0.10`)

**Stories Delivered:**

| Story | Title | Debug Issues | Review Findings | Fixes | Files New | Files Modified |
|-------|-------|-------------|----------------|-------|-----------|---------------|
| 10-1 | Image Compression | 2 | 7 (2H, 3M, 2L) | 5 | 2 | 7 |
| 10-2 | Image Cropping | 2 | Pending | — | 4 | 8 |

**FRs Delivered:**

- FR13: Image compression with quality control — complete
- FR14: Image cropping with aspect ratio presets — implementation complete, review pending

**Tools Added:**

- Image Compressor (`image-compressor`, JPEG/WebP quality-based compression via Canvas API)
- Image Cropper (`image-cropper`, Dialog-based crop workflow with freeform/preset aspect ratios)
- Registry now has 19 tools (up from 17)

**Reusable Patterns Created:**

- `formatFileSize` extracted to `@/utils/file.ts` — shared between ImageCompressor and ImageResizer
- `COMPRESSIBLE_FORMATS` exported from `@/constants/image.ts` — shared constant for JPEG/WebP validation
- Crop utility functions in `@/utils/crop.ts` — `scaleCropToNatural`, `clampCropRegion`, `getDefaultCrop`, `getAspectRatio`
- Dialog + Tabs workflow pattern for tools requiring large interactive canvases

## Previous Retro Follow-Through (Epic 9)

| # | Action Item | Owner | Status | Notes |
|---|-------------|-------|--------|-------|
| 1 | Embed WCAG accessibility checklist as MANDATORY subtask in story creation workflow (3-epic FINAL carry) | Bob (SM) | ❌ Not Addressed | **FOURTH EPIC carrying this.** Stories 10-1 and 10-2 have no explicit WCAG subtask block. The checklist was never formally embedded in the story template. 3-epic rule exceeded. |
| 2 | Document category bootstrap as reusable template | Bob (SM) | ✅ N/A | Epic 10 used existing Image category — no new category created. Template not needed yet. |

**Technical Debt from Epic 9:**

| # | Item | Status |
|---|------|--------|
| 3 | aria-live="polite" on Box Shadow Generator | ⏳ Not addressed (different tool domain) |
| 4 | hexToRgba input validation | ⏳ Not addressed (different tool domain) |

**Technical Patterns Applied:**

| # | Pattern | Status |
|---|---------|--------|
| 1 | Sync processing preference | ✅ N/A — Epic 10 is file-processing (async by nature) |
| 2 | Input dimming during processing | ✅ Applied — 10-1 added after code review, 10-2 applied proactively |
| 3 | Timer cleanup on unmount | ✅ Applied — 10-1 added after code review, 10-2 applied proactively |
| 4 | Test real application code (not local duplicates) | ✅ Applied — 10-1 fixed after review (H2), 10-2 applied proactively |

**Critical pattern confirmed for eighth consecutive epic:** Items not embedded in stories don't get done. The WCAG checklist has been carried 4 epics (7, 8, 9, 10). Per the 3-epic rule established in Epic 8's retro and triggered in Epic 9, this has exceeded the maximum carry period.

## What Went Well

- **Previous Story Intelligence proved highest-ROI practice** — Story 10-2 explicitly applied 6 lessons from 10-1's code review: (1) ProgressBar direct import, (2) clear stale state on new upload, (3) timer cleanup on unmount, (4) input dimming during processing, (5) test real application code, (6) format check. All 6 were applied proactively. Zero repeat issues.
- **Zero regressions across 562 tests** — 24 new tests added in 10-2 alongside 538 existing. All pass. The testing foundation remains rock solid.
- **Utility extraction during implementation** — `formatFileSize` extracted to `@/utils/file.ts` for shared use across ImageCompressor and ImageResizer. `COMPRESSIBLE_FORMATS` exported to `@/constants/image.ts` so tests could import real code. Organic extraction > planned abstractions.
- **Dialog + Tabs workflow innovation in 10-2** — Upload tab → full-screen crop dialog with grid background → download tab. Better UX pattern for tools needing large interactive canvases. Available for future tools.
- **react-image-crop library evaluation was thorough** — Zero dependencies, 4KB gzipped, touch support built-in, React 19 compatible. The right choice for interactive crop overlay UI.
- **Clean separation in crop utilities** — Pure functions (`scaleCropToNatural`, `clampCropRegion`, `getDefaultCrop`) in `@/utils/crop.ts` (testable in node env). Canvas-based crop logic stays in component (requires DOM). Architecture correctly separates concerns.
- **Debug issues were trivial** — All 4 debug issues across both stories were minor (import paths, formatting). No logic bugs during development. File-processing pattern from Epic 3 is well-understood.
- **Existing processImage() utility reused successfully** — Story 10-1 used `processImage()` from `@/utils` with `strategy: 'stretch'` for compression. No new image processing utility needed.

## What Didn't Go Well

- **Story 10-1 had 2 HIGH code review findings** — (H1) Stale compressed result displayed after format rejection — failed to clear source/compressed/originalInfo state. (H2) Tautological tests — spec file created local duplicates of `COMPRESSIBLE_FORMATS` and `formatFileSize` instead of importing actual application code. Both are serious quality gaps that code review caught.
- **3 MEDIUM findings in 10-1 (systemic patterns not applied)** — (M1) Double `processImage` call on upload, (M2) No input dimming during processing, (M3) No progressTimer cleanup on unmount. All three are established patterns that should have been applied from the start. The first story in each epic continues to pay a pattern discovery tax.
- **WCAG checklist carried for 4th epic — exceeded 3-epic rule** — Despite HIGH priority and explicit commitment in Epic 9's retro, the WCAG accessibility checklist was not embedded as a mandatory subtask in the story template. No accessibility-specific findings in Epic 10, but the mechanism remains broken.
- **Story 10-2 still in review at retro time** — Partial retrospective. Some insights from 10-2's code review may be missed. The epic is not formally complete.
- **New external dependency added** — `react-image-crop@11.0.10` breaks the zero-new-deps streak from Epic 9. Justified (complex touch/drag interaction), but adds maintenance surface.

## Key Insights

1. **Previous Story Intelligence is the project's most valuable practice** — 6/6 lessons from 10-1 applied in 10-2 with zero repeat issues. ROI is unambiguous. This practice should be considered mandatory infrastructure for multi-story epics.

2. **File-processing tools have higher code review finding rates than sync tools** — Epic 10 (file tools): 2 HIGH + 3 MEDIUM in 10-1 alone. Compare to Epic 9 (sync tool): 0 HIGH, 4 MEDIUM. File processing introduces state management complexity (stale results, processing state, cleanup) that sync tools don't have. This is a structural difference, not a quality issue.

3. **First-story-in-epic penalty is persistent and predictable** — Story 10-1 needed 5 code review fixes. Story 10-2 (with Previous Story Intelligence) was proactively clean. This pattern has held across every multi-story epic. Budget for higher churn on first stories.

4. **Utility extraction during implementation produces better shared code than upfront design** — `formatFileSize` and `COMPRESSIBLE_FORMATS` were extracted when reuse was discovered naturally. This organic pattern is more reliable than trying to predict shared needs in advance.

5. **The "agree and hope" mechanism for process changes is conclusively broken** — 4 epics of carrying the WCAG checklist proves that retro commitments without structural enforcement do not work. The only reliable mechanism is embedding changes directly in the workflow/template.

6. **All 38 PRD FRs are now implemented** — Epic 10 completes FR13 (image compression) and FR14 (image cropping). The defined product scope is fully delivered across 10 epics, 19 tools, and 562 tests.

## Action Items

### Process Improvements

| # | Action | Owner | Priority | Success Criteria |
|---|--------|-------|----------|-----------------|
| 1 | **FINAL DECISION: Embed WCAG accessibility checklist as mandatory subtask block in story template, OR permanently drop.** 4 epics of carrying proves "agree and hope" doesn't work. The 3-epic rule has been exceeded. If not embedded before next story creation, permanently drop per team rules. | Bob (SM) | HIGH | Either checklist is structural in story template, or item is permanently closed |
| 2 | Add "state cleanup on input rejection" as standard checklist item for file-processing tools. Story 10-1's H1 finding (stale state after rejection) is a pattern that will recur. | Bob (SM) | MEDIUM | Zero stale-state findings in future file tool code reviews |
| 3 | Complete Story 10-2 code review and mark as done | SM/Dev | HIGH | 10-2: review → done, epic-10: in-progress → done |

### Technical Debt

| # | Item | Owner | Priority | Impact |
|---|------|-------|----------|--------|
| 4 | ProgressBar barrel export gap — must import directly from `@/components/common/progress-bar/ProgressBar` | Dev | LOW | Workaround documented in story dev notes, barrel fix is straightforward |
| 5 | `aria-live="polite"` on Box Shadow Generator CSS output (carried from Epic 9) | Dev | LOW | Accessibility gap — screen readers not notified of output changes |
| 6 | `hexToRgba` input validation (carried from Epic 9) | Dev | LOW | Defensive programming — no current failure path |
| 7 | 2 LOW items deferred from 10-1 code review | Dev | LOW | L1 partially addressed, L2 pre-existing barrel gap |

### Team Agreements

**Continued:**

- Scope discipline — no creep without PO approval
- `import type` consistency
- Pure function testing strategy
- Documentation tasks done during the story that creates the drift
- Retro action items MUST be embedded in stories — standalone commitments not allowed
- "Previous Story Intelligence" section required in every story after the first in an epic
- Separate display values from copy values — never pass formatted strings to CopyButton
- Validate parsed external data at runtime — no `as` casts at parse boundaries
- Test assertions must be specific (not `toBeTruthy` or bare `toThrow()`)
- WCAG accessibility attributes are a build-time checklist item, not a review catch
- Theme tokens MUST be used for all color values — hardcoded Tailwind colors not acceptable
- File List in story records must include ALL modified files, even formatting-only changes
- Async debounce with multiple triggers requires `ref` guards beyond `sessionRef`
- Carried items get **3 epics maximum, then permanently drop** — no exceptions
- Sync processing is the low-risk, high-quality pattern; prefer when computation allows
- Category bootstrap is a repeatable mechanical template
- Code review MEDIUM findings for pattern consistency are expected and healthy

**New:**

- Previous Story Intelligence is mandatory and proven — 6/6 lessons applied successfully. This is the highest-ROI practice in the project.
- File-processing tools require state cleanup on rejection — always clear ALL related state (source, result, metadata) when input is rejected
- Utility extraction during implementation > planned abstractions — extract shared code when reuse is discovered, not in advance
- First-story-in-epic bears pattern discovery cost — budget for higher code review churn on first stories
- Dialog + Tabs workflow is available for tools requiring large interactive canvases

## No Next Epic Defined

Epic 11 is not in the planned roadmap. All 38 PRD functional requirements have been implemented across Epics 1-10.

**Product Scope Status:** Complete
- 19 tools across 7 categories (Color, Encoding, Image, Time/Unit, Data, Text, Generator, CSS)
- 562 tests, 0 regressions
- Full CI/CD pipeline (lint, format, test, build)
- 10 epics delivered

**Potential Future Directions (not planned):**

- Quality/polish sprint (address accumulated LOW debt items)
- Community contributions and new tool requests
- Performance optimization or PWA features (NFR21 offline support was deferred)
- Additional tool categories

## Readiness Assessment

- Testing & Quality: ✅ 562 tests passing, CI validates automatically
- Deployment: ✅ Static site, no deployment concerns
- Technical Health: ✅ Stable — accumulated LOW debt items are minor and non-blocking
- Unresolved Blockers: ⚠️ Story 10-2 code review pending
- New Dependencies: ✅ 1 new (`react-image-crop` — lightweight, zero-dep, justified)

## Critical Path

1. **Complete Story 10-2 code review** → Pending
2. **Mark epic-10 as done** → After 10-2 is done
