# Epic 6 Retrospective: Data & Format Tools

**Date:** 2026-02-14
**Facilitator:** Bob (Scrum Master)
**Epic Status:** Complete — 3/3 stories done

## Team Participants

- Bob (Scrum Master) — Facilitator
- Alice (Product Owner) — Product perspective
- Charlie (Senior Dev) — Technical leadership
- Dana (QA Engineer) — Quality perspective
- Elena (Junior Dev) — Fresh eyes perspective
- csrteam (Project Lead) — Overall direction

## Epic Summary & Metrics

**Delivery:**

- Stories completed: 3/3 (100%)
- Velocity: All 3 stories completed in a single session each
- Scope changes: 0
- Production incidents: 0

**Quality:**

- Tests added: 73 new tests (16 JSON + 23 YAML + 34 CSV)
- Total automated tests: 422 (344 at start → 422 at end)
- Code review issues caught: 15 across 3 stories (8 in 6-1, 5 in 6-2, 2 in 6-3)
- Debug issues: 0 (clean implementations across all 3 stories)
- Technical debt introduced: 2 LOW items left as-is (defensive try/catch in 6-1, weak test assertion in 6-2)
- New dependency: 1 (`yaml@2.8.2` — dynamically imported, code-split)

**Stories Delivered:**

| Story | Title | Debug Issues | Review Fixes | Files Created | Files Modified |
|-------|-------|-------------|-------------|---------------|----------------|
| 6-1 | JSON Formatter/Validator | 0 | 7 (1H, 3M, 3L) | 4 | 11 |
| 6-2 | JSON to YAML Converter | 0 | 4 (1H, 3M) | 3 | 7 |
| 6-3 | JSON to CSV Converter | 0 | 5 | 3 | 8 |

**FRs Delivered:**

- FR17: JSON format/validate — complete
- FR18: JSON↔YAML conversion — complete
- FR19: JSON↔CSV conversion — complete

**Tools Added:**

- JSON Formatter (registry key: `json-formatter`)
- JSON ↔ YAML (registry key: `json-to-yaml-converter`)
- JSON ↔ CSV (registry key: `json-to-csv-converter`)
- Registry now has 11 tools (up from 8)
- New tool category created: Data

## Previous Retro Follow-Through (Epic 5)

| # | Action Item | Owner | Status | Notes |
|---|-------------|-------|--------|-------|
| 1 | Embed retro action items into stories | Bob | ✅ Done | All 3 stories have "Previous Story Intelligence" with embedded learnings |
| 2 | Formalize "Previous Story Intelligence" as required story section | Bob | ✅ Done | Present in all 3 story files with explicit cross-story references |
| 3 | Separate display values from copy values in all CopyButton usage | Amelia | ✅ N/A | Epic 6 tools output plain text — copy value equals display value |
| 4 | Runtime validation at parse boundaries — no unsafe `as` casts | Amelia | ✅ Applied | No unsafe `as` casts in Epic 6 code |
| 5 | Add E2E Common Gotchas to CONTRIBUTING.md | Amelia | ❌ Not Addressed | Not embedded in an Epic 6 story |
| 6 | Audit remaining tools for type="number" silent-drop | Amelia | ❌ Not Addressed | Not embedded in an Epic 6 story |

**Pattern confirmed for fourth consecutive epic:** Items not embedded in stories don't get done. Items 5 and 6 were "carried items" from Epic 5 retro but weren't assigned to specific Epic 6 stories.

## What Went Well

- **Cross-story learning is compounding** — Each story explicitly referenced previous story findings. Story 6-3 proactively applied fixes from 6-1 and 6-2 code reviews (null guard, trim check, error message examples). Result: zero debug issues across all 3 stories.
- **Domain foundation pattern** — Story 6-1 established the Data category, domain directory, barrel exports, and sidebar category order. Stories 6-2 and 6-3 reused this foundation with zero setup friction.
- **Progressive acceleration** — Story 6-1 had the most setup work (new domain), 6-2 added async complexity (dynamic imports), 6-3 had the most complex logic (CSV parser) but was the fastest to set up because the pattern was fully established.
- **Zero scope creep, zero blockers, zero debug issues** — Fourth consecutive clean epic.
- **Code review catching real issues** — 15 findings across 3 stories including 2 HIGH severity bugs (misleading AC text, null guard on error messages).
- **Test growth** — 73 new tests bringing total to 422. Strong coverage for all conversion utilities.
- **Smart library decisions** — YAML used a proven external library with dynamic import; CSV was implemented natively in ~80 lines (no library needed). Right tool for each job.

## What Didn't Go Well

- **Whitespace-only input handling — flagged in ALL 3 stories** — Every single story had whitespace handling issues caught in code review. Story 6-1: `formatJson('   ')` threw SyntaxError instead of 'Empty input'. Story 6-2: UX asymmetry between modes on whitespace input. Story 6-3: Addressed proactively but only because of 6-1 and 6-2 lessons.
- **Error message quality — HIGH severity in 2/3 stories** — Story 6-1: AC6 specified `isValidJson` but implementation used `getJsonParseError` (actually a better approach, but documentation diverged from code). Story 6-2: `getJsonParseError()` returning null caused "Invalid JSON: null" to display to users.
- **Test assertion quality — weak patterns in 2/3 stories** — Story 6-1: `toThrow()` without arguments (doesn't verify error message). Story 6-2: `toBeTruthy` for special character tests (doesn't verify actual content).
- **2 carried action items still unaddressed** — E2E gotchas and type="number" audit have now been carried across 3 epics. They keep getting listed but never embedded in stories.

## Key Insights

1. **Whitespace-only input is a universal edge case** — It appeared in every story. Must be treated as a first-class concern in every tool's utility functions and tested explicitly from the start.
2. **Cross-story learning is now a proven accelerator across 2 consecutive epics** — "Previous Story Intelligence" eliminated debug issues in both Epic 5 and Epic 6. The pattern compounds: each story gets smoother.
3. **Error messages need architecture compliance checking** — architecture.md requires examples of valid input in error messages. This wasn't consistently applied until code review caught it.
4. **Test assertions need specificity requirements** — `toBeTruthy` and bare `toThrow()` pass but don't actually verify the right behavior. Strengthened assertions catch real bugs.
5. **Domain foundation investment pays off quickly** — The setup cost in story 6-1 (new category, domain dir, barrel exports) was immediately recouped in stories 6-2 and 6-3 with zero-friction additions.
6. **sessionRef pattern for async state guards is reusable** — Story 6-2 solved stale async results with a generation counter pattern. Any future async tool can reuse this.
7. **Carried items that survive 3+ epics should be dropped or forced into stories** — Items 5 and 6 from Epic 4/5 are now 3 epics old. Either embed them in the next story or drop them.

## Action Items

### Process Improvements

| # | Action | Owner | Priority | Success Criteria |
|---|--------|-------|----------|-----------------|
| 1 | Add whitespace-only input handling to story template checklist | Bob (SM) | HIGH | Every new tool story includes whitespace edge case in test requirements |
| 2 | Strengthen default test assertion patterns — require specific matchers over `toBeTruthy`/`toThrow()` | Bob (SM) | MEDIUM | Code review checklist includes "no weak assertions" item |
| 3 | Add error message architecture compliance check to code review | Bob (SM) | MEDIUM | Every error message includes example of valid input per architecture.md |

### Carried Items (MUST be embedded in Epic 7 stories)

| # | Action | Owner | Priority | Success Criteria |
|---|--------|-------|----------|-----------------|
| 4 | Add E2E Common Gotchas to CONTRIBUTING.md | Amelia (Dev) | MEDIUM | CONTRIBUTING.md Testing section has gotchas subsection |
| 5 | Audit remaining tools for type="number" silent-drop | Amelia (Dev) | MEDIUM | All numeric inputs verified; type="number" switched to type="text" where needed |

### Technical Patterns (embed in Epic 7 story dev notes)

| # | Pattern | Apply When |
|---|---------|------------|
| 6 | `sessionRef` generation counter for async state guards | Any tool with dynamic imports or async processing |
| 7 | Proactive whitespace-only input handling (`input.trim().length`) | Every tool's empty-input check |
| 8 | Error messages must include example of valid input per architecture.md | Every tool's error handling |
| 9 | Test assertions must use specific matchers (`toThrow('message')`, `toContain('value')`) | Every test file |

### Team Agreements

**Continued:**

- Scope discipline — no creep without PO approval
- `import type` consistency
- Pure function testing strategy
- Documentation tasks done during the story that creates the drift
- Retro action items MUST be embedded in stories — standalone commitments are not allowed
- "Previous Story Intelligence" section required in every story after the first in an epic
- Separate display values from copy values — never pass formatted strings to CopyButton
- Validate parsed external data at runtime — no `as` casts at parse boundaries

**New:**

- Whitespace-only input is a first-class edge case — handle in utility functions, test explicitly
- Test assertions must be specific (not `toBeTruthy` or bare `toThrow()`)
- Error messages always include example of valid input per architecture.md
- Items carried 3+ epics must be dropped or force-embedded in the next story

## Epic 7 Preparation

### Critical (before Epic 7 starts)

- [ ] Diff library selection and evaluation (bundle size, ESM, code-split compatibility) — Owner: Charlie
- [ ] Regex timeout/catastrophic backtracking protection strategy — Owner: Charlie

### Parallel (can happen during early stories)

- [ ] Side-by-side diff display component approach (unified vs split view) — Owner: Elena
- [ ] Match highlighting rendering strategy for Regex Tester — Owner: Elena
- [ ] Embed E2E gotchas into first Epic 7 story (carried item 4)
- [ ] Embed type="number" audit into first Epic 7 story touching form inputs (carried item 5)

## Next Epic Preview: Epic 7 — Text Analysis Tools

**Stories:** 2 (Text Diff Checker, Regex Tester)
**FRs covered:** FR20, FR21

**Dependencies on Epic 6:**

- None — Epic 7 depends on Epic 1 and 2 (both complete)

**Key Differences from Epic 6:**

- Both tools require more complex UI (side-by-side diff display, live match highlighting)
- Text Diff Checker requires an external diff library (code-split, lazy-loaded — similar to yaml in 6-2)
- Regex Tester needs timeout protection for catastrophic backtracking patterns
- New category: Text (similar to Data category creation in 6-1)
- Both tools are debounced text processors (same 300ms pattern)

**No significant discoveries requiring Epic 7 plan changes.** Lessons from Epic 6 (whitespace handling, error message quality, cross-story learning) directly strengthen Epic 7 implementation.

## Readiness Assessment

- Testing & Quality: ✅ 422 tests passing, CI validates automatically
- Deployment: ✅ Static site, no deployment concerns
- Stakeholder Acceptance: ✅ Approved by Project Lead
- Technical Health: ✅ Stable — 2 LOW items left as-is (zero impact)
- Unresolved Blockers: ✅ None
- Epic 7 Readiness: ⏳ Pending diff library research and regex timeout strategy
